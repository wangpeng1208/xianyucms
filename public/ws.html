
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>socket test case</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    </head>
<body style="padding: 50px;">
<div>
    <select id="users" class="form-control">
    </select>
</div>
<div style="margin-top: 20px;">
    <textarea class="form-control msgContent"></textarea>
</div>
<div class="btn-group" style="margin-top: 20px;margin-bottom: 80px;">
    <button type="button" class="btn btn-default sendMsg">提交</button>
</div>
<div id="msgData" style="padding:30px;font-weight:bold;">

</div>
    <script type="text/javascript">
        var ws = null;
        var user = "";
 
        ws = new WebSocket("ws://127.0.0.1:2369");

        //连接打开时调用
        ws.onopen = function()
        {
            // 向服务端发起连接成功的字符
            // ws.send('有客户端连接了');
        };

        ws.onmessage = function (evt)
        {
            console.log( "Received Message: " + evt.data);
          /*  var received_msg = evt.data;
            received_msg = JSON.parse(received_msg);
            switch(received_msg.option){
                case 'setName':
                        var html = "<div class='row'>"+received_msg.msg+getNowFormatDate()+"<div>";
                        $("#msgData").prepend(html);
                    break;
                case 'getOnline':
                        var html = "<option value=''>无</option>";
                        for(var i=0;i<received_msg.users.length;i++){
                            if(received_msg.users[i].nickname == user){
                                html += "<option value='"+received_msg.users[i].keyId+"' style='"+received_msg.users[i].nickname+"</option>";
                            }else{
                                html += "<option value='"+received_msg.users[i].keyId+"'>"+received_msg.users[i].nickname+"</option>";
                            }
                        }
                        $("#users").html(html);
                    break;
                case 'outLine':
                        var html = "<div class='row'>"+received_msg.msg+getNowFormatDate()+"<div>";
                        $("#msgData").prepend(html);
                        getOnline();
                    break;
                case 'onLine':
                        var html = "<div class='row'>"+received_msg.msg+getNowFormatDate()+"<div>";
                        $("#msgData").prepend(html);
                        getOnline();
                    break;
                case 'getMsg':
                    var html = "<div class='row'>"+received_msg.msg+getNowFormatDate()+"<div>";
                    $("#msgData").prepend(html);
                    break;
                default:
                    break;
            }*/
        };

        ws.onclose = function()
        {
            // 如果连接关闭重新连接
            // ws = getWebSocket();
        };

        function getOnline(){
            var data = {
                "option":"getOnline",
            };
            var dataSrt = JSON.stringify(data);
            ws.send(dataSrt);
        }
/*        $(function(){
            //获取在线用户
            $(".sendMsg").click(function(){
                var user = $("#users").val();
                var userName = $("#users").find("option:selected").text();
                var msgContent = $(".msgContent").val();
                if(!user){
                    console.log("未找到对象.");
                    return;
                }
                if(!msgContent){
                    console.log("不支持输入为空.");
                    return;
                }
                var data={
                    "option":"sendMsg",
                    "toUser":user,
                    "msgContent":msgContent,
                };
                var dataSrt = JSON.stringify(data);
                ws.send(dataSrt);

                var html = "<div class='row'>给"+userName+"发送消息："+msgContent+getNowFormatDate()+"<div>";
                $("#msgData").prepend(html);
                $(".msgContent").val("");
            });
        });
*/
        Date.prototype.Format = function (fmt) { //author: meizz
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "H+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        };

        function getNowFormatDate() {
            var thisTime = new Date().Format("yyyy-MM-dd HH:mm:ss");
            return "<br>"+thisTime;
        }
    </script>

    <style>
        #msgData .row {
            margin-right: -15px;
            margin-left: -15px;
            margin-bottom: 10px;
            border-bottom: 1px dashed;
        }
    </style>

</body>
</html>